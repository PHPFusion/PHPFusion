/*!
 * ClockPicker v{package.version} (http://weareoutman.github.io/clockpicker/)
 * Copyright 2014 Wang Shenwei.
 * Licensed under MIT (https://github.com/weareoutman/clockpicker/blob/gh-pages/LICENSE)
 */
;(function(){var e=window.jQuery,q=e(window),k=e(document),u;var g="http://www.w3.org/2000/svg",t="SVGAngle" in window&&(function(){var z,A=document.createElement("div");A.innerHTML="<svg/>";z=(A.firstChild&&A.firstChild.namespaceURI)==g;A.innerHTML="";return z})();var o=(function(){var z=document.createElement("div").style;return"transition" in z||"WebkitTransition" in z||"MozTransition" in z||"msTransition" in z||"OTransition" in z})();var i="ontouchstart" in window,r="mousedown"+(i?" touchstart":""),j="mousemove.clockpicker"+(i?" touchmove.clockpicker":""),f="mouseup.clockpicker"+(i?" touchend.clockpicker":"");var d=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null;function x(z){return document.createElementNS(g,z)}function s(z){return(z<10?"0":"")+z}var l=0;function n(z){var A=++l+"";return z?z+A:A}var p=100,w=80,h=54,c=13,m=p*2,b=o?350:1;var y=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");function v(z,D){var H=e(y),E=H.find(".clockpicker-plate"),S=H.find(".clockpicker-hours"),I=H.find(".clockpicker-minutes"),Z=H.find(".clockpicker-am-pm-block"),T=z.prop("tagName")==="INPUT",M=T?z:z.find("input"),O=z.find(".input-group-addon"),R=this,L;this.id=n("cp");this.element=z;this.options=D;this.isAppended=false;this.isShown=false;this.currentView="hours";this.isInput=T;this.input=M;this.addon=O;this.popover=H;this.plate=E;this.hoursView=S;this.minutesView=I;this.amPmBlock=Z;this.spanHours=H.find(".clockpicker-span-hours");this.spanMinutes=H.find(".clockpicker-span-minutes");this.spanAmPm=H.find(".clockpicker-span-am-pm");this.amOrPm="PM";if(D.twelvehour){var J=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");var A=e(J);e('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){R.amOrPm="AM";e(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock);e('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){R.amOrPm="PM";e(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock)}if(!D.autoclose){e('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+D.donetext+"</button>").click(e.proxy(this.done,this)).appendTo(H)}if((D.placement==="top"||D.placement==="bottom")&&(D.align==="top"||D.align==="bottom")){D.align="left"}if((D.placement==="left"||D.placement==="right")&&(D.align==="left"||D.align==="right")){D.align="top"}H.addClass(D.placement);H.addClass("clockpicker-align-"+D.align);this.spanHours.click(e.proxy(this.toggleView,this,"hours"));this.spanMinutes.click(e.proxy(this.toggleView,this,"minutes"));M.on("focus.clockpicker click.clockpicker",e.proxy(this.show,this));O.on("click.clockpicker",e.proxy(this.toggle,this));var U=e('<div class="clockpicker-tick"></div>'),W,X,N,G;if(D.twelvehour){for(W=1;W<13;W+=1){X=U.clone();N=W/6*Math.PI;G=w;X.css("font-size","120%");X.css({left:p+Math.sin(N)*G-c,top:p-Math.cos(N)*G-c});X.html(W===0?"00":W);S.append(X);X.on(r,V)}}else{for(W=0;W<24;W+=1){X=U.clone();N=W/6*Math.PI;var aa=W>0&&W<13;G=aa?h:w;X.css({left:p+Math.sin(N)*G-c,top:p-Math.cos(N)*G-c});if(aa){X.css("font-size","120%")}X.html(W===0?"00":W);S.append(X);X.on(r,V)}}for(W=0;W<60;W+=5){X=U.clone();N=W/30*Math.PI;X.css({left:p+Math.sin(N)*w-c,top:p-Math.cos(N)*w-c});X.css("font-size","120%");X.html(s(W));I.append(X);X.on(r,V)}E.on(r,function(ab){if(e(ab.target).closest(".clockpicker-tick").length===0){V(ab,true)}});function V(ag,ab){var ae=E.offset(),ad=/^touch/.test(ag.type),ac=ae.left+p,aj=ae.top+p,al=(ad?ag.originalEvent.touches[0]:ag).pageX-ac,ak=(ad?ag.originalEvent.touches[0]:ag).pageY-aj,ah=Math.sqrt(al*al+ak*ak),ai=false;if(ab&&(ah<w-c||ah>w+c)){return}ag.preventDefault();var af=setTimeout(function(){u.addClass("clockpicker-moving")},200);if(t){E.append(R.canvas)}R.setHand(al,ak,!ab,true);k.off(j).on(j,function(ao){ao.preventDefault();var an=/^touch/.test(ao.type),am=(an?ao.originalEvent.touches[0]:ao).pageX-ac,ap=(an?ao.originalEvent.touches[0]:ao).pageY-aj;if(!ai&&am===al&&ap===ak){return}ai=true;R.setHand(am,ap,false,true)});k.off(f).on(f,function(ao){k.off(f);ao.preventDefault();var an=/^touch/.test(ao.type),am=(an?ao.originalEvent.changedTouches[0]:ao).pageX-ac,ap=(an?ao.originalEvent.changedTouches[0]:ao).pageY-aj;if((ab||ai)&&am===al&&ap===ak){R.setHand(am,ap)}if(R.currentView==="hours"){R.toggleView("minutes",b/2)}else{if(D.autoclose){R.minutesView.addClass("clockpicker-dial-out");setTimeout(function(){R.done()},b/2)}}E.prepend(C);clearTimeout(af);u.removeClass("clockpicker-moving");k.off(j)})}if(t){var C=H.find(".clockpicker-canvas"),Q=x("svg");Q.setAttribute("class","clockpicker-svg");Q.setAttribute("width",m);Q.setAttribute("height",m);var Y=x("g");Y.setAttribute("transform","translate("+p+","+p+")");var F=x("circle");F.setAttribute("class","clockpicker-canvas-bearing");F.setAttribute("cx",0);F.setAttribute("cy",0);F.setAttribute("r",2);var K=x("line");K.setAttribute("x1",0);K.setAttribute("y1",0);var B=x("circle");B.setAttribute("class","clockpicker-canvas-bg");B.setAttribute("r",c);var P=x("circle");P.setAttribute("class","clockpicker-canvas-fg");P.setAttribute("r",3.5);Y.appendChild(K);Y.appendChild(B);Y.appendChild(P);Y.appendChild(F);Q.appendChild(Y);C.append(Q);this.hand=K;this.bg=B;this.fg=P;this.bearing=F;this.g=Y;this.canvas=C}a(this.options.init)}function a(z){if(z&&typeof z==="function"){z()}}v.DEFAULTS={"default":"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:false,twelvehour:false,vibrate:true};v.prototype.toggle=function(){this[this.isShown?"hide":"show"]()};v.prototype.locate=function(){var C=this.element,E=this.popover,A=C.offset(),z=C.outerWidth(),F=C.outerHeight(),B=this.options.placement,D=this.options.align,H={},G=this;E.show();switch(B){case"bottom":H.top=A.top+F;break;case"right":H.left=A.left+z;break;case"top":H.top=A.top-E.outerHeight();break;case"left":H.left=A.left-E.outerWidth();break}switch(D){case"left":H.left=A.left;break;case"right":H.left=A.left+z-E.outerWidth();break;case"top":H.top=A.top;break;case"bottom":H.top=A.top+F-E.outerHeight();break}E.css(H)};v.prototype.show=function(C){if(this.isShown){return}a(this.options.beforeShow);var z=this;if(!this.isAppended){u=e(document.body).append(this.popover);q.on("resize.clockpicker"+this.id,function(){if(z.isShown){z.locate()}});this.isAppended=true}var B=((this.input.prop("value")||this.options["default"]||"")+"").split(":");if(B[0]==="now"){var A=new Date(+new Date()+this.options.fromnow);B=[A.getHours(),A.getMinutes()]}this.hours=+B[0]||0;this.minutes=+B[1]||0;this.spanHours.html(s(this.hours));this.spanMinutes.html(s(this.minutes));this.toggleView("hours");this.locate();this.isShown=true;k.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(E){var D=e(E.target);if(D.closest(z.popover).length===0&&D.closest(z.addon).length===0&&D.closest(z.input).length===0){z.hide()}});k.on("keyup.clockpicker."+this.id,function(D){if(D.keyCode===27){z.hide()}});a(this.options.afterShow)};v.prototype.hide=function(){a(this.options.beforeHide);this.isShown=false;k.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id);k.off("keyup.clockpicker."+this.id);this.popover.hide();a(this.options.afterHide)};v.prototype.toggleView=function(z,C){var A=false;if(z==="minutes"&&e(this.hoursView).css("visibility")==="visible"){a(this.options.beforeHourSelect);A=true}var B=z==="hours",E=B?this.hoursView:this.minutesView,D=B?this.minutesView:this.hoursView;this.currentView=z;this.spanHours.toggleClass("text-primary",B);this.spanMinutes.toggleClass("text-primary",!B);D.addClass("clockpicker-dial-out");E.css("visibility","visible").removeClass("clockpicker-dial-out");this.resetClock(C);clearTimeout(this.toggleViewTimer);this.toggleViewTimer=setTimeout(function(){D.css("visibility","hidden")},b);if(A){a(this.options.afterHourSelect)}};v.prototype.resetClock=function(z){var E=this.currentView,G=this[E],B=E==="hours",H=Math.PI/(B?6:30),D=G*H,A=B&&G>0&&G<13?h:w,F=Math.sin(D)*A,C=-Math.cos(D)*A,I=this;if(t&&z){I.canvas.addClass("clockpicker-canvas-out");setTimeout(function(){I.canvas.removeClass("clockpicker-canvas-out");I.setHand(F,C)},z)}else{this.setHand(F,C)}};v.prototype.setHand=function(H,F,J,L){var G=Math.atan2(H,-F),E=this.currentView==="hours",K=Math.PI/(E||J?6:30),D=Math.sqrt(H*H+F*F),N=this.options,M=E&&D<(w+h)/2,C=M?h:w,I;if(N.twelvehour){C=w}if(G<0){G=Math.PI*2+G}I=Math.round(G/K);G=I*K;if(N.twelvehour){if(E){if(I===0){I=12}}else{if(J){I*=5}if(I===60){I=0}}}else{if(E){if(I===12){I=0}I=M?(I===0?12:I):I===0?0:I+12}else{if(J){I*=5}if(I===60){I=0}}}if(this[this.currentView]!==I){if(d&&this.options.vibrate){if(!this.vibrateTimer){navigator[d](10);this.vibrateTimer=setTimeout(e.proxy(function(){this.vibrateTimer=null},this),100)}}}this[this.currentView]=I;this[E?"spanHours":"spanMinutes"].html(s(I));if(!t){this[E?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var z=e(this);z.toggleClass("active",I===+z.html())});return}if(L||(!E&&I%5)){this.g.insertBefore(this.hand,this.bearing);this.g.insertBefore(this.bg,this.fg);this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")}else{this.g.insertBefore(this.hand,this.bg);this.g.insertBefore(this.fg,this.bg);this.bg.setAttribute("class","clockpicker-canvas-bg")}var B=Math.sin(G)*C,A=-Math.cos(G)*C;this.hand.setAttribute("x2",B);this.hand.setAttribute("y2",A);this.bg.setAttribute("cx",B);this.bg.setAttribute("cy",A);this.fg.setAttribute("cx",B);this.fg.setAttribute("cy",A)};v.prototype.done=function(){a(this.options.beforeDone);this.hide();var z=this.input.prop("value"),A=s(this.hours)+":"+s(this.minutes);if(this.options.twelvehour){A=A+this.amOrPm}this.input.prop("value",A);if(A!==z){this.input.triggerHandler("change");if(!this.isInput){this.element.trigger("change")}}if(this.options.autoclose){this.input.trigger("blur")}a(this.options.afterDone)};v.prototype.remove=function(){this.element.removeData("clockpicker");this.input.off("focus.clockpicker click.clockpicker");this.addon.off("click.clockpicker");if(this.isShown){this.hide()}if(this.isAppended){q.off("resize.clockpicker"+this.id);this.popover.remove()}};e.fn.clockpicker=function(A){var z=Array.prototype.slice.call(arguments,1);return this.each(function(){var D=e(this),C=D.data("clockpicker");if(!C){var B=e.extend({},v.DEFAULTS,D.data(),typeof A=="object"&&A);D.data("clockpicker",new v(D,B))}else{if(typeof C[A]==="function"){C[A].apply(C,z)}}})}}());