(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("velocity",function(){function e(o){var m={},n=o.split(" ");for(var l=0;l<n.length;++l){m[n[l]]=true}return m}var g=e("#end #else #break #stop #[[ #]] #{end} #{else} #{break} #{stop}");var f=e("#if #elseif #foreach #set #include #parse #macro #define #evaluate #{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}");var i=e("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent.count $foreach.parent.hasNext $foreach.parent.first $foreach.parent.last $foreach.parent $velocityCount $!bodyContent $bodyContent");var c=/[+\-*&%=<>!?:\/|]/;function b(n,m,l){m.tokenize=l;return l(n,m)}function d(p,n){var m=n.beforeParams;n.beforeParams=false;var l=p.next();if((l=="'")&&n.inParams){n.lastTokenWasBuiltin=false;return b(p,n,k(l))}else{if((l=='"')){n.lastTokenWasBuiltin=false;if(n.inString){n.inString=false;return"string"}else{if(n.inParams){return b(p,n,k(l))}}}else{if(/[\[\]{}\(\),;\.]/.test(l)){if(l=="("&&m){n.inParams=true}else{if(l==")"){n.inParams=false;n.lastTokenWasBuiltin=true}}return null}else{if(/\d/.test(l)){n.lastTokenWasBuiltin=false;p.eatWhile(/[\w\.]/);return"number"}else{if(l=="#"&&p.eat("*")){n.lastTokenWasBuiltin=false;return b(p,n,h)}else{if(l=="#"&&p.match(/ *\[ *\[/)){n.lastTokenWasBuiltin=false;return b(p,n,j)}else{if(l=="#"&&p.eat("#")){n.lastTokenWasBuiltin=false;p.skipToEnd();return"comment"}else{if(l=="$"){p.eatWhile(/[\w\d\$_\.{}]/);if(i&&i.propertyIsEnumerable(p.current())){return"keyword"}else{n.lastTokenWasBuiltin=true;n.beforeParams=true;return"builtin"}}else{if(c.test(l)){n.lastTokenWasBuiltin=false;p.eatWhile(c);return"operator"}else{p.eatWhile(/[\w\$_{}@]/);var o=p.current();if(g&&g.propertyIsEnumerable(o)){return"keyword"}if(f&&f.propertyIsEnumerable(o)||(p.current().match(/^#@?[a-z0-9_]+ *$/i)&&p.peek()=="(")&&!(f&&f.propertyIsEnumerable(o.toLowerCase()))){n.beforeParams=true;n.lastTokenWasBuiltin=false;return"keyword"}if(n.inString){n.lastTokenWasBuiltin=false;return"string"}if(p.pos>o.length&&p.string.charAt(p.pos-o.length-1)=="."&&n.lastTokenWasBuiltin){return"builtin"}n.lastTokenWasBuiltin=false;return null}}}}}}}}}}function k(l){return function(q,o){var p=false,n,m=false;while((n=q.next())!=null){if((n==l)&&!p){m=true;break}if(l=='"'&&q.peek()=="$"&&!p){o.inString=true;m=true;break}p=!p&&n=="\\"}if(m){o.tokenize=d}return"string"}}function h(o,n){var l=false,m;while(m=o.next()){if(m=="#"&&l){n.tokenize=d;break}l=(m=="*")}return"comment"}function j(o,n){var l=0,m;while(m=o.next()){if(m=="#"&&l==2){n.tokenize=d;break}if(m=="]"){l++}else{if(m!=" "){l=0}}}return"meta"}return{startState:function(){return{tokenize:d,beforeParams:false,inParams:false,inString:false,lastTokenWasBuiltin:false}},token:function(m,l){if(m.eatSpace()){return null}return l.tokenize(m,l)},blockCommentStart:"#*",blockCommentEnd:"*#",lineComment:"##",fold:"velocity"}});a.defineMIME("text/velocity","velocity")});