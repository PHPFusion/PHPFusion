(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("haml",function(d){var g=a.getMode(d,{name:"htmlmixed"});var b=a.getMode(d,"ruby");function f(h){return function(k,j){var i=k.peek();if(i==h&&j.rubyState.tokenize.length==1){k.next();j.tokenize=e;return"closeAttributeTag"}else{return c(k,j)}}}function c(i,h){if(i.match("-#")){i.skipToEnd();return"comment"}return b.token(i,h.rubyState)}function e(j,i){var h=j.peek();if(i.previousToken.style=="comment"){if(i.indented>i.previousToken.indented){j.skipToEnd();return"commentLine"}}if(i.startOfLine){if(h=="!"&&j.match("!!")){j.skipToEnd();return"tag"}else{if(j.match(/^%[\w:#\.]+=/)){i.tokenize=c;return"hamlTag"}else{if(j.match(/^%[\w:]+/)){return"hamlTag"}else{if(h=="/"){j.skipToEnd();return"comment"}}}}}if(i.startOfLine||i.previousToken.style=="hamlTag"){if(h=="#"||h=="."){j.match(/[\w-#\.]*/);return"hamlAttribute"}}if(i.startOfLine&&!j.match("-->",false)&&(h=="="||h=="-")){i.tokenize=c;return i.tokenize(j,i)}if(i.previousToken.style=="hamlTag"||i.previousToken.style=="closeAttributeTag"||i.previousToken.style=="hamlAttribute"){if(h=="("){i.tokenize=f(")");return i.tokenize(j,i)}else{if(h=="{"){i.tokenize=f("}");return i.tokenize(j,i)}}}return g.token(j,i.htmlState)}return{startState:function(){var h=g.startState();var i=b.startState();return{htmlState:h,rubyState:i,indented:0,previousToken:{style:null,indented:0},tokenize:e}},copyState:function(h){return{htmlState:a.copyState(g,h.htmlState),rubyState:a.copyState(b,h.rubyState),indented:h.indented,previousToken:h.previousToken,tokenize:h.tokenize}},token:function(k,j){if(k.sol()){j.indented=k.indentation();j.startOfLine=true}if(k.eatSpace()){return null}var i=j.tokenize(k,j);j.startOfLine=false;if(i&&i!="commentLine"){j.previousToken={style:i,indented:j.indented}}if(k.eol()&&j.tokenize==c){k.backUp(1);var h=k.peek();k.next();if(h&&h!=","){j.tokenize=e}}if(i=="hamlTag"){i="tag"}else{if(i=="commentLine"){i="comment"}else{if(i=="hamlAttribute"){i="attribute"}else{if(i=="closeAttributeTag"){i=null}}}}return i}}},"htmlmixed","ruby");a.defineMIME("text/x-haml","haml")});