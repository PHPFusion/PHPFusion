(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("rst",function(e,o){var d=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/;var c=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/;var h=/^``[^`\s](?:[^`]*[^`\s])``/;var l=/^(?:[\d]+(?:[\.,]\d+)*)/;var b=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/;var n=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/;var f="[Hh][Tt][Tt][Pp][Ss]?://";var g="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})";var j="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*";var m=new RegExp("^"+f+g+j);var i={token:function(p){if(p.match(d)&&p.match(/\W+|$/,false)){return"strong"}if(p.match(c)&&p.match(/\W+|$/,false)){return"em"}if(p.match(h)&&p.match(/\W+|$/,false)){return"string-2"}if(p.match(l)){return"number"}if(p.match(b)){return"positive"}if(p.match(n)){return"negative"}if(p.match(m)){return"link"}while(p.next()!=null){if(p.match(d,false)){break}if(p.match(c,false)){break}if(p.match(h,false)){break}if(p.match(l,false)){break}if(p.match(b,false)){break}if(p.match(n,false)){break}if(p.match(m,false)){break}}return null}};var k=a.getMode(e,o.backdrop||"rst-base");return a.overlayMode(k,i,true)},"python","stex");a.defineMode("rst-base",function(L){function B(aa){var Z=Array.prototype.slice.call(arguments,1);return aa.replace(/{(\d+)}/g,function(ab,ac){return typeof Z[ac]!="undefined"?Z[ac]:ab})}var n=a.getMode(L,"python");var c=a.getMode(L,"stex");var o="\\s+";var p="(?:\\s*|\\W|$)",w=new RegExp(B("^{0}",p));var I="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",R=new RegExp(B("^{0}",I));var Q="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)";var s=B("(?:{0}|`{1}`)",I,Q);var i="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)";var g="(?:[^\\`]+)",u=new RegExp(B("^{0}",g));var H=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$");var P=new RegExp(B("^\\.\\.{0}",o));var r=new RegExp(B("^_{0}:{1}|^__:{1}",s,p));var E=new RegExp(B("^{0}::{1}",s,p));var v=new RegExp(B("^\\|{0}\\|{1}{2}::{3}",i,o,s,p));var q=new RegExp(B("^\\[(?:\\d+|#{0}?|\\*)]{1}",s,p));var D=new RegExp(B("^\\[{0}\\]{1}",s,p));var W=new RegExp(B("^\\|{0}\\|",i));var G=new RegExp(B("^\\[(?:\\d+|#{0}?|\\*)]_",s));var M=new RegExp(B("^\\[{0}\\]_",s));var C=new RegExp(B("^{0}__?",s));var A=new RegExp(B("^`{0}`_",g));var k=new RegExp(B("^:{0}:`{1}`{2}",I,g,p));var T=new RegExp(B("^`{1}`:{0}:{2}",I,g,p));var S=new RegExp(B("^:{0}:{1}",I,p));var m=new RegExp(B("^{0}",s));var X=new RegExp(B("^::{0}",p));var f=new RegExp(B("^\\|{0}\\|",i));var z=new RegExp(B("^{0}",o));var U=new RegExp(B("^{0}",s));var F=new RegExp(B("^::{0}",p));var y=new RegExp("^_");var x=new RegExp(B("^{0}|_",s));var l=new RegExp(B("^:{0}",p));var K=new RegExp("^::\\s*$");var V=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");function e(ab,aa){var Z=null;if(ab.sol()&&ab.match(V,false)){b(aa,N,{mode:n,local:a.startState(n)})}else{if(ab.sol()&&ab.match(P)){b(aa,O);Z="meta"}else{if(ab.sol()&&ab.match(H)){b(aa,e);Z="header"}else{if(h(aa)==k||ab.match(k,false)){switch(j(aa)){case 0:b(aa,e,Y(k,1));ab.match(/^:/);Z="meta";break;case 1:b(aa,e,Y(k,2));ab.match(R);Z="keyword";if(ab.current().match(/^(?:math|latex)/)){aa.tmp_stex=true}break;case 2:b(aa,e,Y(k,3));ab.match(/^:`/);Z="meta";break;case 3:if(aa.tmp_stex){aa.tmp_stex=undefined;aa.tmp={mode:c,local:a.startState(c)}}if(aa.tmp){if(ab.peek()=="`"){b(aa,e,Y(k,4));aa.tmp=undefined;break}Z=aa.tmp.mode.token(ab,aa.tmp.local);break}b(aa,e,Y(k,4));ab.match(u);Z="string";break;case 4:b(aa,e,Y(k,5));ab.match(/^`/);Z="meta";break;case 5:b(aa,e,Y(k,6));ab.match(w);break;default:b(aa,e)}}else{if(h(aa)==T||ab.match(T,false)){switch(j(aa)){case 0:b(aa,e,Y(T,1));ab.match(/^`/);Z="meta";break;case 1:b(aa,e,Y(T,2));ab.match(u);Z="string";break;case 2:b(aa,e,Y(T,3));ab.match(/^`:/);Z="meta";break;case 3:b(aa,e,Y(T,4));ab.match(R);Z="keyword";break;case 4:b(aa,e,Y(T,5));ab.match(/^:/);Z="meta";break;case 5:b(aa,e,Y(T,6));ab.match(w);break;default:b(aa,e)}}else{if(h(aa)==S||ab.match(S,false)){switch(j(aa)){case 0:b(aa,e,Y(S,1));ab.match(/^:/);Z="meta";break;case 1:b(aa,e,Y(S,2));ab.match(R);Z="keyword";break;case 2:b(aa,e,Y(S,3));ab.match(/^:/);Z="meta";break;case 3:b(aa,e,Y(S,4));ab.match(w);break;default:b(aa,e)}}else{if(h(aa)==W||ab.match(W,false)){switch(j(aa)){case 0:b(aa,e,Y(W,1));ab.match(f);Z="variable-2";break;case 1:b(aa,e,Y(W,2));if(ab.match(/^_?_?/)){Z="link"}break;default:b(aa,e)}}else{if(ab.match(G)){b(aa,e);Z="quote"}else{if(ab.match(M)){b(aa,e);Z="quote"}else{if(ab.match(C)){b(aa,e);if(!ab.peek()||ab.peek().match(/^\W$/)){Z="link"}}else{if(h(aa)==A||ab.match(A,false)){switch(j(aa)){case 0:if(!ab.peek()||ab.peek().match(/^\W$/)){b(aa,e,Y(A,1))}else{ab.match(A)}break;case 1:b(aa,e,Y(A,2));ab.match(/^`/);Z="link";break;case 2:b(aa,e,Y(A,3));ab.match(u);break;case 3:b(aa,e,Y(A,4));ab.match(/^`_/);Z="link";break;default:b(aa,e)}}else{if(ab.match(K)){b(aa,J)}else{if(ab.next()){b(aa,e)}}}}}}}}}}}}}return Z}function O(ab,aa){var Z=null;if(h(aa)==v||ab.match(v,false)){switch(j(aa)){case 0:b(aa,O,Y(v,1));ab.match(f);Z="variable-2";break;case 1:b(aa,O,Y(v,2));ab.match(z);break;case 2:b(aa,O,Y(v,3));ab.match(U);Z="keyword";break;case 3:b(aa,O,Y(v,4));ab.match(F);Z="meta";break;default:b(aa,e)}}else{if(h(aa)==E||ab.match(E,false)){switch(j(aa)){case 0:b(aa,O,Y(E,1));ab.match(m);Z="keyword";if(ab.current().match(/^(?:math|latex)/)){aa.tmp_stex=true}else{if(ab.current().match(/^python/)){aa.tmp_py=true}}break;case 1:b(aa,O,Y(E,2));ab.match(X);Z="meta";if(ab.match(/^latex\s*$/)||aa.tmp_stex){aa.tmp_stex=undefined;b(aa,N,{mode:c,local:a.startState(c)})}break;case 2:b(aa,O,Y(E,3));if(ab.match(/^python\s*$/)||aa.tmp_py){aa.tmp_py=undefined;b(aa,N,{mode:n,local:a.startState(n)})}break;default:b(aa,e)}}else{if(h(aa)==r||ab.match(r,false)){switch(j(aa)){case 0:b(aa,O,Y(r,1));ab.match(y);ab.match(x);Z="link";break;case 1:b(aa,O,Y(r,2));ab.match(l);Z="meta";break;default:b(aa,e)}}else{if(ab.match(q)){b(aa,e);Z="quote"}else{if(ab.match(D)){b(aa,e);Z="quote"}else{ab.eatSpace();if(ab.eol()){b(aa,e)}else{ab.skipToEnd();b(aa,t);Z="comment"}}}}}}return Z}function t(aa,Z){return d(aa,Z,"comment")}function J(aa,Z){return d(aa,Z,"meta")}function d(ab,aa,Z){if(ab.eol()||ab.eatSpace()){ab.skipToEnd();return Z}else{b(aa,e);return null}}function N(aa,Z){if(Z.ctx.mode&&Z.ctx.local){if(aa.sol()){if(!aa.eatSpace()){b(Z,e)}return null}return Z.ctx.mode.token(aa,Z.ctx.local)}b(Z,e);return null}function Y(Z,aa,ac,ab){return{phase:Z,stage:aa,mode:ac,local:ab}}function b(ab,aa,Z){ab.tok=aa;ab.ctx=Z||{}}function j(Z){return Z.ctx.stage||0}function h(Z){return Z.ctx.phase}return{startState:function(){return{tok:e,ctx:Y(undefined,0)}},copyState:function(ab){var Z=ab.ctx,aa=ab.tmp;if(Z.local){Z={mode:Z.mode,local:a.copyState(Z.mode,Z.local)}}if(aa){aa={mode:aa.mode,local:a.copyState(aa.mode,aa.local)}}return{tok:ab.tok,ctx:Z,tmp:aa}},innerMode:function(Z){return Z.tmp?{state:Z.tmp.local,mode:Z.tmp.mode}:Z.ctx.mode?{state:Z.ctx.local,mode:Z.ctx.mode}:null},token:function(aa,Z){return Z.tok(aa,Z)}}},"python","stex");a.defineMIME("text/x-rst","rst")});