(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror",require("../xml/xml")))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../xml/xml"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("markdown",function(x,y){var o=a.modes.hasOwnProperty("xml");var j=a.getMode(x,o?{name:"xml",htmlMode:true}:"text/plain");var B={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"};var F=(function(){var Z,ad={},X={},ac;var ab=[];for(var W in a.modes){if(a.modes.propertyIsEnumerable(W)){ab.push(W)}}for(Z=0;Z<ab.length;Z++){ad[ab[Z]]=ab[Z]}var aa=[];for(var W in a.mimeModes){if(a.mimeModes.propertyIsEnumerable(W)){aa.push({mime:W,mode:a.mimeModes[W]})}}for(Z=0;Z<aa.length;Z++){ac=aa[Z].mime;X[ac]=aa[Z].mime}for(var Y in B){if(B[Y] in ad||B[Y] in X){ad[Y]=B[Y]}}return function(ae){return ad[ae]?a.getMode(x,ad[ae]):null}}());if(y.highlightFormatting===undefined){y.highlightFormatting=false}if(y.maxBlockquoteDepth===undefined){y.maxBlockquoteDepth=0}if(y.underscoresBreakWords===undefined){y.underscoresBreakWords=true}if(y.fencedCodeBlocks===undefined){y.fencedCodeBlocks=false}if(y.taskLists===undefined){y.taskLists=false}var k=0;var i="header",g="comment",q="quote",P="variable-2",N="variable-3",M="keyword",O="hr",h="tag",t="formatting",p="link",m="link",G="link",E="string",Q="em",z="strong";var b=/^([*\-=_])(?:\s*\1){2,}\s*$/,e=/^[*\-+]\s+/,C=/^[0-9]+\.\s+/,s=/^\[(x| )\](?=\s)/,S=/^#+/,V=/^(?:\={1,}|-{1,})$/,A=/^[^#!\[\]*_\\<>` "'(]+/;function T(Y,X,W){X.f=X.inline=W;return W(Y,X)}function D(Y,X,W){X.f=X.block=W;return W(Y,X)}function c(W){W.linkTitle=false;W.em=false;W.strong=false;W.quote=0;if(!o&&W.f==r){W.f=R;W.block=J}W.trailingSpace=0;W.trailingSpaceNewLine=false;W.thisLineHasContent=false;return null}function J(ab,aa){var Z=ab.sol();var X=(aa.list!==false);if(aa.list!==false&&aa.indentationDiff>=0){if(aa.indentationDiff<4){aa.indentation-=aa.indentationDiff}aa.list=null}else{if(aa.list!==false&&aa.indentation>0){aa.list=null;aa.listDepth=Math.floor(aa.indentation/4)}else{if(aa.list!==false){aa.list=false;aa.listDepth=0}}}var W=null;if(aa.indentationDiff>=4){aa.indentation-=4;ab.skipToEnd();return g}else{if(ab.eatSpace()){return null}else{if(W=ab.match(S)){aa.header=W[0].length<=6?W[0].length:6;if(y.highlightFormatting){aa.formatting="header"}aa.f=aa.inline;return v(aa)}else{if(aa.prevLineHasContent&&(W=ab.match(V))){aa.header=W[0].charAt(0)=="="?1:2;if(y.highlightFormatting){aa.formatting="header"}aa.f=aa.inline;return v(aa)}else{if(ab.eat(">")){aa.indentation++;aa.quote=Z?1:aa.quote+1;if(y.highlightFormatting){aa.formatting="quote"}ab.eatSpace();return v(aa)}else{if(ab.peek()==="["){return T(ab,aa,d)}else{if(ab.match(b,true)){return O}else{if((!aa.prevLineHasContent||X)&&(ab.match(e,false)||ab.match(C,false))){var Y=null;if(ab.match(e,true)){Y="ul"}else{ab.match(C,true);Y="ol"}aa.indentation+=4;aa.list=true;aa.listDepth++;if(y.taskLists&&ab.match(s,false)){aa.taskList=true}aa.f=aa.inline;if(y.highlightFormatting){aa.formatting=["list","list-"+Y]}return v(aa)}else{if(y.fencedCodeBlocks&&ab.match(/^```([\w+#]*)/,true)){aa.localMode=F(RegExp.$1);if(aa.localMode){aa.localState=aa.localMode.startState()}D(ab,aa,I);if(y.highlightFormatting){aa.formatting="code-block"}aa.code=true;return v(aa)}}}}}}}}}return T(ab,aa,aa.inline)}function r(Y,X){var W=j.token(Y,X.htmlState);if((o&&X.htmlState.tagStart===null&&!X.htmlState.context)||(X.md_inside&&Y.current().indexOf(">")>-1)){X.f=R;X.block=J;X.htmlState=null}return W}function I(Y,X){if(Y.sol()&&Y.match(/^```/,true)){X.localMode=X.localState=null;X.f=R;X.block=J;if(y.highlightFormatting){X.formatting="code-block"}X.code=true;var W=v(X);X.code=false;return W}else{if(X.localMode){return X.localMode.token(Y,X.localState)}else{Y.skipToEnd();return g}}}function v(Z){var Y=[];if(Z.formatting){Y.push(t);if(typeof Z.formatting==="string"){Z.formatting=[Z.formatting]}for(var W=0;W<Z.formatting.length;W++){Y.push(t+"-"+Z.formatting[W]);if(Z.formatting[W]==="header"){Y.push(t+"-"+Z.formatting[W]+"-"+Z.header)}if(Z.formatting[W]==="quote"){if(!y.maxBlockquoteDepth||y.maxBlockquoteDepth>=Z.quote){Y.push(t+"-"+Z.formatting[W]+"-"+Z.quote)}else{Y.push("error")}}}}if(Z.taskOpen){Y.push("meta");return Y.length?Y.join(" "):null}if(Z.taskClosed){Y.push("property");return Y.length?Y.join(" "):null}if(Z.linkHref){Y.push(E);return Y.length?Y.join(" "):null}if(Z.strong){Y.push(z)}if(Z.em){Y.push(Q)}if(Z.linkText){Y.push(G)}if(Z.code){Y.push(g)}if(Z.header){Y.push(i);Y.push(i+"-"+Z.header)}if(Z.quote){Y.push(q);if(!y.maxBlockquoteDepth||y.maxBlockquoteDepth>=Z.quote){Y.push(q+"-"+Z.quote)}else{Y.push(q+"-"+y.maxBlockquoteDepth)}}if(Z.list!==false){var X=(Z.listDepth-1)%3;if(!X){Y.push(P)}else{if(X===1){Y.push(N)}else{Y.push(M)}}}if(Z.trailingSpaceNewLine){Y.push("trailing-space-new-line")}else{if(Z.trailingSpace){Y.push("trailing-space-"+(Z.trailingSpace%2?"a":"b"))}}return Y.length?Y.join(" "):null}function n(X,W){if(X.match(A,true)){return v(W)}return undefined}function R(al,X){var Y=X.text(al,X);if(typeof Y!=="undefined"){return Y}if(X.list){X.list=null;return v(X)}if(X.taskList){var ab=al.match(s,true)[1]!=="x";if(ab){X.taskOpen=true}else{X.taskClosed=true}if(y.highlightFormatting){X.formatting="task"}X.taskList=false;return v(X)}X.taskOpen=false;X.taskClosed=false;if(X.header&&al.match(/^#+$/,true)){if(y.highlightFormatting){X.formatting="header"}return v(X)}var ad=al.sol();var W=al.next();if(W==="\\"){al.next();if(y.highlightFormatting){var ae=v(X);return ae?ae+" formatting-escape":"formatting-escape"}}if(X.linkTitle){X.linkTitle=false;var ah=W;if(W==="("){ah=")"}ah=(ah+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var ag="^\\s*(?:[^"+ah+"\\\\]+|\\\\\\\\|\\\\.)"+ah;if(al.match(new RegExp(ag),true)){return E}}if(W==="`"){var aj=X.formatting;if(y.highlightFormatting){X.formatting="code"}var am=v(X);var af=al.pos;al.eatWhile("`");var Z=1+al.pos-af;if(!X.code){k=Z;X.code=true;return v(X)}else{if(Z===k){X.code=false;return am}X.formatting=aj;return v(X)}}else{if(X.code){return v(X)}}if(W==="!"&&al.match(/\[[^\]]*\] ?(?:\(|\[)/,false)){al.match(/\[[^\]]*\]/);X.inline=X.f=w;return h}if(W==="["&&al.match(/.*\](\(| ?\[)/,false)){X.linkText=true;if(y.highlightFormatting){X.formatting="link"}return v(X)}if(W==="]"&&X.linkText){if(y.highlightFormatting){X.formatting="link"}var ae=v(X);X.linkText=false;X.inline=X.f=w;return ae}if(W==="<"&&al.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,false)){X.f=X.inline=L;if(y.highlightFormatting){X.formatting="link"}var ae=v(X);if(ae){ae+=" "}else{ae=""}return ae+p}if(W==="<"&&al.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,false)){X.f=X.inline=L;if(y.highlightFormatting){X.formatting="link"}var ae=v(X);if(ae){ae+=" "}else{ae=""}return ae+m}if(W==="<"&&al.match(/^\w/,false)){if(al.string.indexOf(">")!=-1){var ac=al.string.substring(1,al.string.indexOf(">"));if(/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(ac)){X.md_inside=true}}al.backUp(1);X.htmlState=a.startState(j);return D(al,X,r)}if(W==="<"&&al.match(/^\/\w*?>/)){X.md_inside=false;return"tag"}var aa=false;if(!y.underscoresBreakWords){if(W==="_"&&al.peek()!=="_"&&al.match(/(\w)/,false)){var ai=al.pos-2;if(ai>=0){var ak=al.string.charAt(ai);if(ak!=="_"&&ak.match(/(\w)/,false)){aa=true}}}}if(W==="*"||(W==="_"&&!aa)){if(ad&&al.peek()===" "){}else{if(X.strong===W&&al.eat(W)){if(y.highlightFormatting){X.formatting="strong"}var am=v(X);X.strong=false;return am}else{if(!X.strong&&al.eat(W)){X.strong=W;if(y.highlightFormatting){X.formatting="strong"}return v(X)}else{if(X.em===W){if(y.highlightFormatting){X.formatting="em"}var am=v(X);X.em=false;return am}else{if(!X.em){X.em=W;if(y.highlightFormatting){X.formatting="em"}return v(X)}}}}}}else{if(W===" "){if(al.eat("*")||al.eat("_")){if(al.peek()===" "){return v(X)}else{al.backUp(1)}}}}if(W===" "){if(al.match(/ +$/,false)){X.trailingSpace++}else{if(X.trailingSpace){X.trailingSpaceNewLine=true}}}return v(X)}function L(Z,Y){var X=Z.next();if(X===">"){Y.f=Y.inline=R;if(y.highlightFormatting){Y.formatting="link"}var W=v(Y);if(W){W+=" "}else{W=""}return W+p}Z.match(/^[^>]+/,true);return p}function w(Y,X){if(Y.eatSpace()){return null}var W=Y.next();if(W==="("||W==="["){X.f=X.inline=K(W==="("?")":"]");if(y.highlightFormatting){X.formatting="link-string"}X.linkHref=true;return v(X)}return"error"}function K(W){return function(aa,Z){var Y=aa.next();if(Y===W){Z.f=Z.inline=R;if(y.highlightFormatting){Z.formatting="link-string"}var X=v(Z);Z.linkHref=false;return X}if(aa.match(u(W),true)){aa.backUp(1)}Z.linkHref=true;return v(Z)}}function d(X,W){if(X.match(/^[^\]]*\]:/,false)){W.f=H;X.next();if(y.highlightFormatting){W.formatting="link"}W.linkText=true;return v(W)}return T(X,W,R)}function H(Y,X){if(Y.match(/^\]:/,true)){X.f=X.inline=f;if(y.highlightFormatting){X.formatting="link"}var W=v(X);X.linkText=false;return W}Y.match(/^[^\]]+/,true);return G}function f(X,W){if(X.eatSpace()){return null}X.match(/^[^\s]+/,true);if(X.peek()===undefined){W.linkTitle=true}else{X.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,true)}W.f=W.inline=R;return E}var U=[];function u(W){if(!U[W]){W=(W+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");U[W]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+W+")")}return U[W]}var l={startState:function(){return{f:J,prevLineHasContent:false,thisLineHasContent:false,block:J,htmlState:null,indentation:0,inline:R,text:n,formatting:false,linkText:false,linkHref:false,linkTitle:false,em:false,strong:false,header:0,taskList:false,list:false,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:false}},copyState:function(W){return{f:W.f,prevLineHasContent:W.prevLineHasContent,thisLineHasContent:W.thisLineHasContent,block:W.block,htmlState:W.htmlState&&a.copyState(j,W.htmlState),indentation:W.indentation,localMode:W.localMode,localState:W.localMode?a.copyState(W.localMode,W.localState):null,inline:W.inline,text:W.text,formatting:false,linkTitle:W.linkTitle,em:W.em,strong:W.strong,header:W.header,taskList:W.taskList,list:W.list,listDepth:W.listDepth,quote:W.quote,trailingSpace:W.trailingSpace,trailingSpaceNewLine:W.trailingSpaceNewLine,md_inside:W.md_inside}},token:function(ab,aa){aa.formatting=false;if(ab.sol()){var X=!!aa.header;aa.header=0;if(ab.match(/^\s*$/,true)||X){aa.prevLineHasContent=false;c(aa);return X?this.token(ab,aa):null}else{aa.prevLineHasContent=aa.thisLineHasContent;aa.thisLineHasContent=true}aa.taskList=false;aa.code=false;aa.trailingSpace=0;aa.trailingSpaceNewLine=false;aa.f=aa.block;var Y=ab.match(/^\s*/,true)[0].replace(/\t/g,"    ").length;var ac=Math.floor((Y-aa.indentation)/4)*4;if(ac>4){ac=4}var Z=aa.indentation+ac;aa.indentationDiff=Z-aa.indentation;aa.indentation=Z;if(Y>0){return null}}var W=aa.f(ab,aa);if(ab.start==ab.pos){return this.token(ab,aa)}else{return W}},innerMode:function(W){if(W.block==r){return{state:W.htmlState,mode:j}}if(W.localState){return{state:W.localState,mode:W.localMode}}return{state:W,mode:l}},blankLine:c,getType:v,fold:"markdown"};return l},"xml");a.defineMIME("text/x-markdown","markdown")});