(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../smarty/smarty"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../htmlmixed/htmlmixed","../smarty/smarty"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("smartymixed",function(c){var e=a.getMode(c,"htmlmixed");var k=a.getMode(c,"smarty");var d={rightDelimiter:"}",leftDelimiter:"{"};if(c.hasOwnProperty("leftDelimiter")){d.leftDelimiter=c.leftDelimiter}if(c.hasOwnProperty("rightDelimiter")){d.rightDelimiter=c.rightDelimiter}function g(l){return l.replace(/[^\s\w]/g,"\\$&")}var i=g(d.leftDelimiter),h=g(d.rightDelimiter);var f={smartyComment:new RegExp("^"+h+"\\*"),literalOpen:new RegExp(i+"literal"+h),literalClose:new RegExp(i+"/literal"+h),hasLeftDelimeter:new RegExp(".*"+i),htmlHasLeftDelimeter:new RegExp("[^<>]*"+i)};var b={chain:function(m,l,n){l.tokenize=n;return n(m,l)},cleanChain:function(m,l,n){l.tokenize=null;l.localState=null;l.localMode=null;return(typeof n=="string")?(n?n:null):n(m,l)},maybeBackup:function(r,n,o){var q=r.current();var p=q.search(n),l;if(p>-1){r.backUp(q.length-p)}else{if(l=q.match(/<\/?$/)){r.backUp(q.length);if(!r.match(n,false)){r.match(q[0])}}}return o}};var j={html:function(n,l){var m=l.htmlMixedState.htmlState.context&&l.htmlMixedState.htmlState.context.tagName?l.htmlMixedState.htmlState.context.tagName:null;if(!l.inLiteral&&n.match(f.htmlHasLeftDelimeter,false)&&m===null){l.tokenize=j.smarty;l.localMode=k;l.localState=k.startState(e.indent(l.htmlMixedState,""));return b.maybeBackup(n,d.leftDelimiter,k.token(n,l.localState))}else{if(!l.inLiteral&&n.match(d.leftDelimiter,false)){l.tokenize=j.smarty;l.localMode=k;l.localState=k.startState(e.indent(l.htmlMixedState,""));return b.maybeBackup(n,d.leftDelimiter,k.token(n,l.localState))}}return e.token(n,l.htmlMixedState)},smarty:function(m,l){if(m.match(d.leftDelimiter,false)){if(m.match(f.smartyComment,false)){return b.chain(m,l,j.inBlock("comment","*"+d.rightDelimiter))}}else{if(m.match(d.rightDelimiter,false)){m.eat(d.rightDelimiter);l.tokenize=j.html;l.localMode=e;l.localState=l.htmlMixedState;return"tag"}}return b.maybeBackup(m,d.rightDelimiter,k.token(m,l.localState))},inBlock:function(m,l){return function(o,n){while(!o.eol()){if(o.match(l)){b.cleanChain(o,n,"");break}o.next()}return m}}};return{startState:function(){var l=e.startState();return{token:j.html,localMode:null,localState:null,htmlMixedState:l,tokenize:null,inLiteral:false}},copyState:function(n){var m=null,l=(n.tokenize||n.token);if(n.localState){m=a.copyState((l!=j.html?k:e),n.localState)}return{token:n.token,tokenize:n.tokenize,localMode:n.localMode,localState:m,htmlMixedState:a.copyState(e,n.htmlMixedState),inLiteral:n.inLiteral}},token:function(n,m){if(n.match(d.leftDelimiter,false)){if(!m.inLiteral&&n.match(f.literalOpen,true)){m.inLiteral=true;return"keyword"}else{if(m.inLiteral&&n.match(f.literalClose,true)){m.inLiteral=false;return"keyword"}}}if(m.inLiteral&&m.localState!=m.htmlMixedState){m.tokenize=j.html;m.localMode=e;m.localState=m.htmlMixedState}var l=(m.tokenize||m.token)(n,m);return l},indent:function(m,l){if(m.localMode==k||(m.inLiteral&&!m.localMode)||f.hasLeftDelimeter.test(l)){return a.Pass}return e.indent(m.htmlMixedState,l)},innerMode:function(l){return{state:l.localState||l.htmlMixedState,mode:l.localMode||e}}}},"htmlmixed","smarty");a.defineMIME("text/x-smarty","smartymixed")});